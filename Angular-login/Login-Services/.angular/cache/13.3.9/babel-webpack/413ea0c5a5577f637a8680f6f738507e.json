{"ast":null,"code":"import { VERSION } from '@angular/core';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../save-order.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nconst _c0 = [\"csvReader\"];\nfunction OrderSubmissionComponent_a_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"a\", 8);\n    i0.ɵɵlistener(\"click\", function OrderSubmissionComponent_a_9_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.getJsonData();\n    });\n    i0.ɵɵtext(1, \"Convert Json \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction OrderSubmissionComponent_a_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"a\", 8);\n    i0.ɵɵlistener(\"click\", function OrderSubmissionComponent_a_10_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.fileReset();\n    });\n    i0.ɵɵtext(1, \"Reset \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction OrderSubmissionComponent_table_12_tr_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"th\", 13);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"td\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"td\");\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"td\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"td\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"td\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const record_r9 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.make);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.model);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.year);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.fuelType);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.customerId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.customerName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.city);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.orderId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(record_r9.orderStatus);\n  }\n}\nfunction OrderSubmissionComponent_table_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 9)(1, \"thead\", 10)(2, \"tr\")(3, \"th\", 11);\n    i0.ɵɵtext(4, \"Make\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\", 11);\n    i0.ɵɵtext(6, \"Model\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\", 11);\n    i0.ɵɵtext(8, \"Year\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\", 11);\n    i0.ɵɵtext(10, \"FuelType\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"th\", 11);\n    i0.ɵɵtext(12, \"CustomerId\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"th\", 11);\n    i0.ɵɵtext(14, \"CustomerName\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"th\", 11);\n    i0.ɵɵtext(16, \"City\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"th\", 11);\n    i0.ɵɵtext(18, \"OrderId\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"th\", 11);\n    i0.ɵɵtext(20, \"OrderStatus\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(21, \"tbody\");\n    i0.ɵɵtemplate(22, OrderSubmissionComponent_table_12_tr_22_Template, 19, 9, \"tr\", 12);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(22);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r3.records);\n  }\n}\nexport class CsvData {}\nexport let OrderSubmissionComponent = /*#__PURE__*/(() => {\n  class OrderSubmissionComponent {\n    constructor(orderService, router) {\n      this.orderService = orderService;\n      this.router = router;\n      this.name = 'Angular ' + VERSION.major;\n      this.records = [];\n    }\n    uploadListener(files) {\n      // let fileList = (<HTMLInputElement>files.target).files;\n      let fileList = files.target.files;\n      if (fileList && fileList.length > 0) {\n        let file = fileList[0];\n        console.log(file.name);\n        console.log(file.size);\n        console.log(file.type);\n        let reader = new FileReader();\n        reader.readAsBinaryString(file);\n        console.log(reader);\n        reader.onload = e => {\n          // const result = new ReplaySubject<string>(1);\n          let csvData = reader.result;\n          console.log(csvData);\n          let csvRecordsArray = csvData.split(/\\r\\n|\\n/);\n          console.log(csvRecordsArray);\n          let headersRow = this.getHeaderArray(csvRecordsArray);\n          this.records = this.getDataRecordsArrayFromCSVFile(csvRecordsArray, headersRow.length);\n          if (this.records != null) {\n            this.fileContent = csvData;\n            console.log(this.fileContent);\n            this.uploadFile();\n          }\n        };\n        reader.onerror = function () {\n          console.log('error is occured while reading file!');\n        };\n      } else {\n        alert(\"Please import valid .csv file.\");\n        this.fileReset();\n      }\n    }\n    getDataRecordsArrayFromCSVFile(csvRecordsArray, headerLength) {\n      let csvArr = [];\n      for (let i = 1; i < csvRecordsArray.length; i++) {\n        let curruntRecord = csvRecordsArray[i].split(',');\n        if (curruntRecord.length == headerLength) {\n          let csvRecord = new CsvData();\n          csvRecord.make = curruntRecord[0].trim();\n          csvRecord.model = curruntRecord[1].trim();\n          csvRecord.year = curruntRecord[2].trim();\n          csvRecord.fuelType = curruntRecord[3].trim();\n          csvRecord.customerId = curruntRecord[4].trim();\n          csvRecord.customerName = curruntRecord[5].trim();\n          csvRecord.city = curruntRecord[6].trim();\n          // csvRecord.orderId = curruntRecord[7].trim();\n          // csvRecord.orderStatus = curruntRecord[8].trim();\n          csvArr.push(csvRecord);\n        }\n      }\n      return csvArr;\n    }\n    //check etension\n    isValidCSVFile(file) {\n      return file.name.endsWith(\".csv\");\n    }\n    getHeaderArray(csvRecordsArr) {\n      let headers = csvRecordsArr[0].split(',');\n      let headerArray = [];\n      for (let j = 0; j < headers.length; j++) {\n        headerArray.push(headers[j]);\n      }\n      return headerArray;\n    }\n    fileReset() {\n      this.csvReader.nativeElement.value = \"\";\n      this.records = [];\n      this.jsondatadisplay = '';\n    }\n    getJsonData() {\n      this.jsondatadisplay = JSON.stringify(this.records);\n    }\n    //   onFileSelected(event : any) {\n    //     this.uploadListener(event.target.files[0]).subscribe((decode: string | undefined) => {\n    // this.fileContent=decode;\n    //     });\n    //   }\n    uploadFile() {\n      const observable = this.orderService.uploadFile(this.fileContent);\n      // const observable = this.orderService.uploadFiles(this.records) ;\n      observable.subscribe(response => {\n        alert(\"File upload Success\");\n      }, error => {\n        alert(error);\n      });\n    }\n  }\n  OrderSubmissionComponent.ɵfac = function OrderSubmissionComponent_Factory(t) {\n    return new (t || OrderSubmissionComponent)(i0.ɵɵdirectiveInject(i1.SaveOrderService), i0.ɵɵdirectiveInject(i2.Router));\n  };\n  OrderSubmissionComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: OrderSubmissionComponent,\n    selectors: [[\"app-order-submission\"]],\n    viewQuery: function OrderSubmissionComponent_Query(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵviewQuery(_c0, 5);\n      }\n      if (rf & 2) {\n        let _t;\n        i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.csvReader = _t.first);\n      }\n    },\n    decls: 13,\n    vars: 4,\n    consts: [[1, \"container\"], [1, \"card\"], [1, \"card-header\"], [1, \"card-body\"], [\"type\", \"file\", \"name\", \"Upload CSV\", \"id\", \"txtFileUpload\", 3, \"change\"], [\"csvReader\", \"\"], [\"href\", \"javascript:;\", \"class\", \"btn btn-primary\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"table\", 4, \"ngIf\"], [\"href\", \"javascript:;\", 1, \"btn\", \"btn-primary\", 3, \"click\"], [1, \"table\"], [1, \"thead-dark\"], [\"scope\", \"col\"], [4, \"ngFor\", \"ngForOf\"], [\"scope\", \"row\"]],\n    template: function OrderSubmissionComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"h1\");\n        i0.ɵɵtext(1, \"Upload Files\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(2, \"div\", 0)(3, \"div\", 1)(4, \"div\", 2);\n        i0.ɵɵtext(5, \" Upload csv to read \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"div\", 3)(7, \"input\", 4, 5);\n        i0.ɵɵlistener(\"change\", function OrderSubmissionComponent_Template_input_change_7_listener($event) {\n          return ctx.uploadListener($event);\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(9, OrderSubmissionComponent_a_9_Template, 2, 0, \"a\", 6);\n        i0.ɵɵtemplate(10, OrderSubmissionComponent_a_10_Template, 2, 0, \"a\", 6);\n        i0.ɵɵtext(11);\n        i0.ɵɵtemplate(12, OrderSubmissionComponent_table_12_Template, 23, 1, \"table\", 7);\n        i0.ɵɵelementEnd();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(9);\n        i0.ɵɵproperty(\"ngIf\", ctx.records.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.records.length > 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵtextInterpolate1(\" \", ctx.jsondatadisplay, \" \");\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.records.length > 0);\n      }\n    },\n    directives: [i3.NgIf, i3.NgForOf],\n    styles: [\"p[_ngcontent-%COMP%]{font-family:Lato}.table[_ngcontent-%COMP%], .container[_ngcontent-%COMP%]{margin-top:20px}.btn[_ngcontent-%COMP%]{margin-right:20px;margin-top:20px}\"]\n  });\n  return OrderSubmissionComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}